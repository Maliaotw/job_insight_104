"""
é é¢æ¨™é¡Œå’Œä»‹ç´¹å…ƒä»¶æ¨¡çµ„ã€‚

æ­¤æ¨¡çµ„æä¾›å‰µå»ºæ‡‰ç”¨ç¨‹åºæ¨™é¡Œå’Œä»‹ç´¹çš„åŠŸèƒ½ã€‚
éµå¾ªå…ƒä»¶åŒ–è¨­è¨ˆåŸå‰‡ï¼Œå°‡UIå…ƒä»¶èˆ‡æ¥­å‹™é‚è¼¯åˆ†é›¢ã€‚

ä½œè€…: Job Insight 104 Team
ç‰ˆæœ¬: 2.0.0
"""

import streamlit as st
from typing import Optional, Dict
from datetime import datetime
from config.settings import logger


def create_title(title: str = "ğŸ“Š 104 è·ç¼ºå¸‚å ´æ´å¯Ÿå¹³å°") -> None:
    """
    å‰µå»ºé é¢æ¨™é¡Œã€‚

    åƒæ•¸:
        title: é é¢æ¨™é¡Œæ–‡å­—
    """
    st.title(title)


def create_introduction(introduction: Optional[str] = None) -> None:
    """
    å‰µå»ºé é¢ä»‹ç´¹æ–‡å­—ã€‚

    åƒæ•¸:
        introduction: ä»‹ç´¹æ–‡å­—ï¼Œå¦‚æœç‚ºNoneå‰‡ä½¿ç”¨é»˜èªä»‹ç´¹
    """
    if introduction is None:
        introduction = """
        é€™å€‹å¹³å°æä¾›åŸºæ–¼ 104 è·ç¼ºæ•¸æ“šçš„å¸‚å ´åˆ†æèˆ‡è¦–è¦ºåŒ–åŠŸèƒ½ï¼Œå¹«åŠ©æ‚¨äº†è§£å°ç£å°±æ¥­å¸‚å ´çš„å‹•æ…‹è®ŠåŒ–ã€‚
        """

    st.markdown(introduction)


def create_subheader(page: str) -> None:
    """
    æ ¹æ“šç•¶å‰é é¢å‰µå»ºå‹•æ…‹å­æ¨™é¡Œã€‚

    åƒæ•¸:
        page: ç•¶å‰é é¢åç¨±
    """
    # é é¢å°æ‡‰çš„å­æ¨™é¡Œ
    page_subheaders = {
        "ç¸½è¦½ Dashboard": "å¸‚å ´æ¦‚æ³èˆ‡é—œéµæŒ‡æ¨™",
        "æ¯æ—¥è·ç¼ºè®ŠåŒ–åˆ†æ": "è·ç¼ºæ•¸é‡è®ŠåŒ–è¶¨å‹¢èˆ‡åˆ†æ",
        "ç”¢æ¥­è·ç¼ºåˆ†ä½ˆèˆ‡è¶¨å‹¢": "å„ç”¢æ¥­è·ç¼ºåˆ†ä½ˆèˆ‡ç™¼å±•è¶¨å‹¢",
        "æ‹›è˜æ•ˆç‡åˆ†æ": "ä¼æ¥­æ‹›è˜æµç¨‹æ•ˆç‡æŒ‡æ¨™",
        "è–ªè³‡èˆ‡åœ°å€åˆ†æ": "å„åœ°å€èˆ‡è·ä½è–ªè³‡æ°´å¹³æ¯”è¼ƒ"
    }

    # ç²å–ç•¶å‰é é¢çš„å­æ¨™é¡Œ
    subheader = page_subheaders.get(page, "")

    if subheader:
        st.subheader(subheader)


def create_last_updated_info() -> None:
    """
    å‰µå»ºæœ€å¾Œæ›´æ–°æ™‚é–“ä¿¡æ¯ã€‚
    """
    # ç²å–ç•¶å‰æ™‚é–“ä½œç‚ºæœ€å¾Œæ›´æ–°æ™‚é–“
    last_updated = datetime.now().strftime("%Y-%m-%d %H:%M:%S")

    # åœ¨å³å´é¡¯ç¤ºæœ€å¾Œæ›´æ–°æ™‚é–“
    col1, col2 = st.columns([3, 1])
    with col2:
        st.caption(f"æœ€å¾Œæ›´æ–°: {last_updated}")


def create_help_button() -> None:
    """
    å‰µå»ºå¹«åŠ©æŒ‰éˆ•ï¼Œç‚ºæ–°ç”¨æˆ¶æä¾›ä½¿ç”¨æŒ‡å—ã€‚
    """
    with st.expander("ğŸ’¡ ä½¿ç”¨æŒ‡å—", expanded=False):
        st.markdown("""
        ### å¦‚ä½•ä½¿ç”¨æœ¬å¹³å°

        1. **é¸æ“‡åˆ†æé é¢**: åœ¨å·¦å´å°èˆªæ¬„é¸æ“‡æ‚¨æƒ³æŸ¥çœ‹çš„åˆ†æé é¢
        2. **è¨­ç½®éæ¿¾æ¢ä»¶**: ä½¿ç”¨å·¦å´éæ¿¾å™¨é¸æ“‡é—œéµè©ã€åŸå¸‚ã€åœ°å€ç­‰
        3. **æŸ¥çœ‹åˆ†æçµæœ**: åœ¨ä¸»é é¢æŸ¥çœ‹æ•¸æ“šè¦–è¦ºåŒ–å’Œåˆ†æçµæœ
        4. **äº’å‹•æ¢ç´¢**: é»æ“Šåœ–è¡¨å…ƒç´ å¯æŸ¥çœ‹æ›´è©³ç´°çš„ä¿¡æ¯

        ### å¸¸è¦‹å•é¡Œ

        - **æ•¸æ“šä¾†æº**: æ‰€æœ‰æ•¸æ“šä¾†è‡ª104äººåŠ›éŠ€è¡Œç¶²ç«™
        - **æ›´æ–°é »ç‡**: æ•¸æ“šæ¯æ—¥è‡ªå‹•æ›´æ–°
        - **éæ¿¾æ¢ä»¶**: å¯ä»¥çµ„åˆå¤šå€‹éæ¿¾æ¢ä»¶é€²è¡Œç²¾ç¢ºåˆ†æ
        """)


def create_header(title: str = "ğŸ“Š 104 è·ç¼ºå¸‚å ´æ´å¯Ÿå¹³å°", introduction: Optional[str] = None, page: str = "ç¸½è¦½ Dashboard") -> None:
    """
    å‰µå»ºé é¢æ¨™é¡Œå’Œä»‹ç´¹ã€‚

    åƒæ•¸:
        title: é é¢æ¨™é¡Œæ–‡å­—
        introduction: ä»‹ç´¹æ–‡å­—ï¼Œå¦‚æœç‚ºNoneå‰‡ä½¿ç”¨é»˜èªä»‹ç´¹
        page: ç•¶å‰é é¢åç¨±ï¼Œç”¨æ–¼å‰µå»ºå‹•æ…‹å­æ¨™é¡Œ
    """
    try:
        # å‰µå»ºæ¨™é¡Œå’Œä»‹ç´¹
        create_title(title)
        create_introduction(introduction)

        # å‰µå»ºæœ€å¾Œæ›´æ–°æ™‚é–“ä¿¡æ¯
        create_last_updated_info()

        # å‰µå»ºå‹•æ…‹å­æ¨™é¡Œ
        create_subheader(page)

        # å‰µå»ºå¹«åŠ©æŒ‰éˆ•
        create_help_button()

        logger.debug(f"å‰µå»ºé é¢æ¨™é¡Œ: {title}, é é¢: {page}")
    except Exception as e:
        logger.error(f"å‰µå»ºé é¢æ¨™é¡Œæ™‚ç™¼ç”ŸéŒ¯èª¤: {str(e)}", exc_info=True)
        st.error("è¼‰å…¥é é¢æ¨™é¡Œæ™‚ç™¼ç”ŸéŒ¯èª¤ã€‚")
